extends ../layout

block content
    .container
        h1 Your Cart

        #cart-items
        // This section will display items if there are any in the cart
        p No items in cart yet.

        .checkout-button-container
        button.btn.btn-primary(onclick="checkout()") Checkout

    script.
        // Display items from sessionStorage in the cart
        function displayCartItems() {
            const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
            const cartItemsContainer = document.getElementById('cart-items');
            
            // Check if cart is empty
            if (cart.length === 0) {
            cartItemsContainer.innerHTML = "<p>No items in cart yet.</p>";
            return;
            }
            
            // Render the cart items dynamically
            cartItemsContainer.innerHTML = cart.map(item => `
            <div class="cart-item">
                <p><strong>${item.name}</strong></p>
                <p>Quantity: ${item.quantity}</p>
                <p>Price: $${item.price}</p>
            </div>
            `).join('');
        }

        // Call displayCartItems when the page loads
        document.addEventListener('DOMContentLoaded', displayCartItems);

        // Send cart data to the backend for checkout
        async function checkout() {
            const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
            
            // Check if the cart is empty
            if (cart.length === 0) {
            alert("Your cart is empty.");
            return;
            }

            try {
            // Make a POST request to the backend with the cart data
            const response = await fetch('/cart/checkout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cartItems: cart })
            });

            const result = await response.json();

            // Handle response
            if (response.ok) {
                alert(result.message);
                sessionStorage.removeItem('cart'); // Clear the cart after checkout
                window.location.href = '/'; // Redirect to the homepage or order confirmation page
            } else {
                alert(result.message); // Show the error message from the backend
            }
            } catch (error) {
            console.error('Checkout error:', error);
            alert('There was an error processing your checkout.');
            }
        }
